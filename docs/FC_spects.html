<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>FC_spects.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>FC_spects.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>filename: FC_Spects.py
including the class everything stems from:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">Spect</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">mmap</span><span class="o">,</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <h1>CHANGELOG</h1>
<p>to version 0.1.5:<br />
 1) removed GFC-class<br />
 2) Added term for energy-correction in case of gradient.
 3) Changed setting self.type.</p>
<p>to version 0.1.0:<br />
 1) Added some sense to GFC<br />
 2) Removed the HR-classes from the code<br />
 3) In FC: final states frequencies in use.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>All models that are based on FC-scheme are based on this class.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">FC_spect</span><span class="p">(</span><span class="n">Spect</span><span class="o">.</span><span class="n">Spect</span><span class="p">):</span> <span class="c1"># import class Spect from file Spect.</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Since it doesn't need any more data than the DR-scheme, everything 
  initialised for Spect is initialized here already and hence no extra
  init()-function is needed.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>first, initialise as done for all spectra:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">==</span><span class="s2">&quot;Spect&quot;</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>don't set it if this is CFC-calculation.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>         <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="s1">&#39;FC&#39;</span>
      <span class="n">Spect</span><span class="o">.</span><span class="n">Spect</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>now, calculate HR-spect in addition.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">HRthresh</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">r&quot;(?&lt;=HRthreshold=)[ \d.]+&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">opt</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">HRthresh</span><span class="o">==</span><span class="p">[]:</span>
         <span class="n">HRthresh</span><span class="o">=</span><span class="mf">0.015</span>
      <span class="k">else</span><span class="p">:</span> 
         <span class="n">HRthresh</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">HRthresh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">HuangR</span><span class="p">(</span><span class="n">HRthresh</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>get N, M from opt</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">calcspect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>M,N are maximal numbers of vibrational modes 
    (+1, since they should be arrived really; count from 0)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="bp">self</span><span class="o">.</span><span class="n">states1</span><span class="o">+=</span><span class="mi">1</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">states2</span><span class="o">+=</span><span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>as frequency, use the final states frequency.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Calculate Franck-Condon factors under assumption of equal frequencies</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="k">def</span> <span class="nf">FCeqf</span><span class="p">(</span> <span class="n">Deltag</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>for only one vibrational mode</p>
<p><em>PARAMETERS:</em>
  Deltag: HR-factor of respective state
  N:      excitation number of initial state
  M:      excitation number of final state</p>
<p><em>RETURNS:</em>
  Franck-Condon factor of the respective transition</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">fact</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">factorial</span>
          <span class="n">faktNM</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">fact</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">*</span><span class="n">fact</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
          <span class="n">FC</span><span class="o">=</span><span class="mi">0</span>
          <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="c1"># +1: to go to really reach min(M,N).</span>
             <span class="n">FC</span><span class="o">+=</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">Deltag</span><span class="p">,(</span><span class="n">M</span><span class="o">+</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fact</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">fact</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">*</span>\
                   <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">faktNM</span><span class="p">)</span><span class="o">/</span><span class="n">fact</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">FC</span><span class="o">*</span><span class="n">FC</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Calculation of the line spectrum respecting only shift of minima</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="k">def</span> <span class="nf">unifSpect</span><span class="p">(</span><span class="n">intens</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">FC00</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>(no Duschinsky rotation, no change if frequency) 
 and assuming coinciding frequencies for initial and final state</p>
<p><strong>PARAMETERS:</strong>
 intens: matrix of intensities of transitions
 freqs:  matrix of respective energies</p>
<p><strong>RETURNS</strong>
 a 3-dimensional array with energies of transition (1. column), their 
 rate (2. column) and the number of changing mode.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">J</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">intens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="n">spect</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">intens</span><span class="p">)</span><span class="o">*</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>first transition: 0-0 transition. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">spect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">FC00</span> <span class="c1">#0-&gt;0 transition</span>
          <span class="n">spect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">E</span>
          <span class="n">spect</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intens</span><span class="p">)):</span><span class="c1">#make this easier: reshapeing of intens, freqs</span>
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">J</span><span class="p">):</span>
                <span class="n">spect</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="o">*</span><span class="n">J</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">spect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="o">*</span><span class="n">J</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="n">spect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">*</span><span class="n">J</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
          <span class="k">return</span> <span class="n">spect</span>
    
       <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">)</span> <span class="c1">#=len(freq)</span>
       <span class="n">setM</span><span class="o">=</span><span class="bp">False</span>
       <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">states2</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>there was not specified, how many vibr. states in ground-state 
    should be taken into account</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">setM</span><span class="o">=</span><span class="bp">True</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">states2</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">6.4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">9.</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>i.e. take M following an empirical value as function of the HR-file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="k">assert</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;There is no Huang-Rhys factor larger than the respective&quot;</span><span class="o">+</span>\
                                        <span class="s2">&quot;threshold. No mode to be calculated.&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>if setM: the size of these arrays will be overestimated.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="n">FC</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">states2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">states1</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
       <span class="n">uency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">states2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">states1</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1">#frequency</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>avoiding dots accelerates python quite a lot</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="n">loggingwrite</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">write</span>
       <span class="n">npexp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span> 
       <span class="n">E</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Energy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>set  0-&gt;0 transition:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="n">sgnE</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
       <span class="n">uency00</span><span class="o">=</span><span class="n">E</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hartree2cm_1</span> <span class="c1">#zero-zero transition</span>
       <span class="n">FC00</span><span class="o">=</span><span class="mf">1.00</span>
       <span class="k">if</span> <span class="n">sgnE</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">sgnE</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>here a goes over all modes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>print a, HR[a]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states1</span><span class="p">):</span>  <span class="c1"># initial state</span>
             <span class="k">if</span> <span class="n">setM</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>set M to fit best to the value at that moment.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                <span class="n">M</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="mf">6.4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="mf">9.</span><span class="p">))</span>
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states2</span><span class="p">):</span>  <span class="c1">#final states</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>skip 0-0 transitions</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                   <span class="k">continue</span>
                <span class="n">tmp</span><span class="o">=</span><span class="n">FCeqf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                   <span class="n">FC</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="o">*</span><span class="n">M</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span><span class="o">*</span><span class="n">FC00</span><span class="o">*</span><span class="n">npexp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">*</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                   <span class="n">uency</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="o">*</span><span class="n">M</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">sgnE</span><span class="o">*</span><span class="n">E</span><span class="o">+</span><span class="n">sgnE</span><span class="o">*</span><span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hartree2cm_1</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                   <span class="n">loggingwrite</span><span class="p">(</span><span class="s2">&quot;WARNING: truncated spectrum for mode nr. </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
                   <span class="k">break</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">spect</span><span class="o">=</span><span class="n">unifSpect</span><span class="p">(</span><span class="n">FC</span><span class="p">,</span> <span class="n">uency</span><span class="p">,</span> <span class="n">sgnE</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hartree2cm_1</span><span class="p">,</span> <span class="n">FC00</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>This function does row-wise Gram-Schmidt orthonormalization of</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">gs</span><span class="p">(</span><span class="n">A</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>matrices.
  code for Gram-Schmidt adapted from iizukak, 
  see https://gist.github.com/iizukak/1287876</p>
<p>def proj(v1, v2):
return map(lambda x : x *(np.dot(v2,v1) / np.dot(v1, v1)) , v1)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    
       <span class="n">X</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">T</span> <span class="c1"># I want to orthogonalize row-wise</span>
       <span class="n">Y</span> <span class="o">=</span> <span class="p">[]</span>
       <span class="n">npdot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span>
       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
          <span class="n">temp_vec</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="k">for</span> <span class="n">inY</span> <span class="ow">in</span> <span class="n">Y</span> <span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>proj_vec = proj(inY, X[i])</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>             <span class="n">proj_vec</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">*</span><span class="p">(</span><span class="n">npdot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">inY</span><span class="p">)</span> <span class="o">/</span> 
                 <span class="n">npdot</span><span class="p">(</span><span class="n">inY</span><span class="p">,</span> <span class="n">inY</span><span class="p">))</span> <span class="p">,</span> <span class="n">inY</span><span class="p">)</span>
             <span class="n">temp_vec</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="n">temp_vec</span><span class="p">,</span> <span class="n">proj_vec</span><span class="p">)</span>
          <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">temp_vec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">temp_vec</span><span class="p">))</span> <span class="c1"># normalise vectors</span>
       <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="c1"># undo transposition in the beginning</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>Function that calculates the Huang-Rhys factors for all</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">HuangR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">HRthresh</span><span class="p">):</span> <span class="c1">#what is with different frequencies???</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>vibrational states</p>
<p><strong>PARAMETERS</strong>
  HRthresh threshold for lowest HR-factor (number)</p>
<p><strong>CALCULATES</strong>
  uniHRall   HR-factors for coinciding frequencies sorted by size (decreasing)
  uniFall    respective frequencies (same order)</p>
<p><strong>RETURNES</strong>
  nothing. All results are members of class  FC_Spect.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">lenK</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
      <span class="n">sortHR</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">lenK</span><span class="p">)</span>
      <span class="n">HR</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">lenK</span><span class="p">)</span>
      <span class="n">fsort</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">lenK</span><span class="p">)</span>
      <span class="n">uniFall</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenK</span><span class="p">):</span>
         <span class="n">HR</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nm</span><span class="o">.</span><span class="n">K</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*.</span><span class="mi">5</span> 
      <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">HR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;heapsort&#39;</span><span class="p">)</span>
      <span class="n">sortHR</span><span class="o">=</span><span class="n">HR</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
      <span class="n">fsort0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
      <span class="n">fsort1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">sortHR</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: some HR-factors are &lt;0.</span><span class="se">\</span>
<span class="s1">                  In the following their absolute value is used.&#39;</span><span class="p">)</span>
         <span class="n">sortHR</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sortHR</span><span class="p">)</span>
      <span class="n">uniHR</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">uniF1</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">uniF0</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">loggingwrite</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">write</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>now remove modes with too low frequency;
they can easily make some trouble!</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fsort1</span><span class="p">)):</span>
         <span class="k">if</span> <span class="n">fsort1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hartree2cm_1</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
            <span class="n">fsort1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fsort1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="n">fsort0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">fsort0</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="n">sortHR</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">sortHR</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>

      <span class="k">if</span> <span class="n">sortHR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">10</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>if larges HR-factor is too large</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>         <span class="n">loggingwrite</span><span class="p">(</span><span class="s1">u&#39;</span><span class="se">\n</span><span class="s1">WARNING: THE HUANG-RHYS FACTOR SEEMS TO BE&#39;</span><span class="o">+</span>\
                                                         <span class="s1">&#39; TOO LARGE !!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
         <span class="n">loggingwrite</span><span class="p">(</span><span class="s1">u&#39;        the spectrum will be calculated, but most probably&#39;</span><span class="o">+</span>\
                                       <span class="s1">&#39; the input-state is inconsistent.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
         <span class="n">loggingwrite</span><span class="p">(</span><span class="s1">u&#39;        Please check the xyz-file created.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">makeXYZ</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>the HR-factors are printed allways.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">loggingwrite</span><span class="p">(</span><span class="s1">u&#39;HR-fact           freq     delta</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>print(u'HR-fact           freq\n')</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sortHR</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>select all 'big' HR-factors </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>         <span class="k">if</span> <span class="n">sortHR</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">HRthresh</span><span class="p">:</span>
            <span class="n">uniHR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sortHR</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">uniF1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fsort1</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">uniF0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fsort0</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">loggingwrite</span><span class="p">(</span><span class="s2">u&quot;</span><span class="si">%f</span><span class="s2">   </span><span class="si">%f</span><span class="s2">   </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sortHR</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">fsort1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hartree2cm_1</span><span class="p">,</span> 
                                             <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fsort1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">fsort0</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="p">))</span>
         <span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>there will come only smaller ones.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">break</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>keep order: First one is initial, second is final state.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">uniFall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uniF0</span><span class="p">)</span>
      <span class="n">uniFall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uniF1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>now, make the new results being objects of that class:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="o">=</span><span class="n">uniHR</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">=</span><span class="n">uniFall</span>
      <span class="n">Esign</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Energy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">Esign</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">Energy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Energy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="n">Esign</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">CFC_spect</span><span class="p">(</span><span class="n">FC_spect</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>first, initialise as done for all spectra:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="s1">&#39;CFC&#39;</span>
      <span class="n">FC_spect</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>This is used to calculate the line spectrum assuming no mode mixing</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">calcspect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>(shift only)  and coinciding frequencies in both electronic states.</p>
<p><strong>PARAMETERS:</strong>
  HR:     Huang-Rhys factors
  n:      number of modes that are considered here (with biggest HR)
  freq:   frequencies (have to be in the same order as HR
  E:      energy difference of energy surfaces
  N,M:    are the numbers of vibrational quanta can be in the modes
  All arguments are neccesary.</p>
<p><strong>RETURNS:</strong>
  nothing (output into /tmp/linspect)</p>
<p>M,N are maximal numbers of vibrational modes (+1, since they should 
     be arrived really; count from 0)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">+=</span><span class="mi">1</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">+=</span><span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="k">def</span> <span class="nf">FCchf</span><span class="p">(</span><span class="n">HR</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">freq</span><span class="p">):</span>
          <span class="n">npsqrt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span>
          <span class="n">D</span><span class="o">=</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">HR</span><span class="p">)</span> <span class="c1"># define this to become consistent with given formula</span>
          <span class="n">delta</span><span class="o">=</span><span class="n">npsqrt</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="n">deltasquare</span><span class="o">=</span><span class="n">delta</span><span class="o">*</span><span class="n">delta</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <p>R00=sqrt(2<em>delta/(1+delta</em>delta))<em>np.exp(-.5</em>D<em>D/(1+delta</em>delta))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>R_00 is normalisation -&gt; actually calculate FC_ij/FC_00 --&gt; 
                    than I can chose FC_00 outside.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mf">1.00</span>
          <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">deltasquare</span><span class="p">)</span> 
          <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">D</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">deltasquare</span><span class="p">)</span>
          <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">D</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">delta</span><span class="o">*</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">deltasquare</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
             <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span>
                      <span class="p">(</span><span class="n">deltasquare</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>\
                      <span class="o">/</span><span class="p">(</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">deltasquare</span><span class="p">))</span>
             <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">npsqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span>\
                      <span class="p">(</span><span class="n">deltasquare</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">npsqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>\
                      <span class="o">/</span><span class="p">(</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">deltasquare</span><span class="p">))</span>
          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
             <span class="n">R</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">deltasquare</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>\
                      <span class="o">/</span><span class="p">(</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">deltasquare</span><span class="p">))</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">deltasquare</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span>\
                      <span class="mf">2.</span><span class="o">*</span><span class="n">D</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>\
                      <span class="o">/</span><span class="p">(</span><span class="n">npsqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">deltasquare</span><span class="p">))</span>
          <span class="k">return</span> <span class="n">R</span> <span class="c1"># this is matrix with square roots of transition probabilities</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>Calculation of the line spectrum respecting only shift of minima</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="k">def</span> <span class="nf">unifSpect</span><span class="p">(</span><span class="n">intens</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">FC00</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>(no Duschinsky rotation) 
 and assuming coinciding frequencies for initial and final state</p>
<p><strong>PARAMETERS:</strong>
 intens: matrix of intensities of transitions
 freqs:  matrix of respective energies</p>
<p><strong>RETURNS</strong>
 a 2-dimensional array with energies of transition (1. column) and their 
 rate (2. column)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">J</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">intens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
          <span class="n">spect</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">intens</span><span class="p">)</span><span class="o">*</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>first transition: 0-0 transition. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">spect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">FC00</span> <span class="c1">#0-&gt;0 transition</span>
          <span class="n">spect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">E</span>
          <span class="n">spect</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intens</span><span class="p">)):</span>
             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">J</span><span class="p">):</span>
                <span class="n">spect</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="o">*</span><span class="n">J</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">spect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="o">*</span><span class="n">J</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="n">spect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">*</span><span class="n">J</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
          <span class="k">return</span> <span class="n">spect</span>
   
       <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">)</span> <span class="c1">#=len(freq)</span>
       <span class="n">setM</span><span class="o">=</span><span class="bp">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>correct for vibrational groundstates:
E+=(sum(freq[0])-sum(freq[1]))*.5
print E, freq[0]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>there was not specified, how many vibr. states in ground-state 
          should be taken into account</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">setM</span><span class="o">=</span><span class="bp">True</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">6.4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">5.</span><span class="p">))</span>
       <span class="k">assert</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;There is no Huang-Rhys factor larger than the respective&quot;</span><span class="o">+</span>\
                    <span class="s2">&quot; threshold. No mode to be calculated.&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>if setM: the size of these arrays will be overestimated.
calculate 0-&gt;0 transition</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="n">FC00</span><span class="o">=</span><span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>print 0,0,0, 10</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="n">loggingwrite</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">write</span> <span class="c1">#avoid dots!</span>
       <span class="n">npexp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span>                  <span class="c1">#to accelerates python quite a lot</span>
       <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span>

       <span class="n">FC</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
       <span class="n">uency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span> <span class="c1">#frequency</span>
       <span class="n">E</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Energy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>here a goes over all modes</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>       <span class="n">sgnE</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
       <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">sgnE</span><span class="o">=</span><span class="mi">1</span>
       <span class="n">uency00</span><span class="o">=</span><span class="n">sgnE</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hartree2cm_1</span> <span class="c1">#zero-zero transition</span>
       <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">setM</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-54'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-54'>#</a>
      </div>
      <p>set M to fit best to the value at that moment.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>             <span class="n">M</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="mf">6.4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="mf">5.</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-55'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-55'>#</a>
      </div>
      <p>print a, HR[a]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>          <span class="n">R</span><span class="o">=</span><span class="n">FCchf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HR</span><span class="p">[</span><span class="n">a</span><span class="p">],</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,[</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">a</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">a</span><span class="p">]])</span>
          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span> 
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-56'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-56'>#</a>
      </div>
      <p>skip 0-0 transitions</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>                   <span class="k">continue</span>
                <span class="n">tmp</span><span class="o">=</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                   <span class="n">FC</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="o">*</span><span class="n">M</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span><span class="o">*</span><span class="n">FC00</span><span class="o">*</span><span class="n">npexp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">a</span><span class="p">]</span><span class="o">*</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
                   <span class="n">uency</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="o">*</span><span class="n">M</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">sgnE</span><span class="o">*</span><span class="p">(</span><span class="n">E</span><span class="o">+</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">a</span><span class="p">]</span><span class="o">*</span><span class="n">j</span><span class="o">-</span><span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">a</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hartree2cm_1</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                   <span class="n">logwrite</span><span class="p">(</span><span class="s2">&quot;WARNING: truncated spectrum for mode nr. </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
                   <span class="k">break</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">spect</span><span class="o">=</span><span class="n">unifSpect</span><span class="p">(</span><span class="n">FC</span><span class="p">,</span> <span class="n">uency</span><span class="p">,</span> <span class="n">sgnE</span><span class="o">*</span><span class="n">E</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hartree2cm_1</span><span class="p">,</span> <span class="n">FC00</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-57'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-57'>#</a>
      </div>
      <p>version 0.1.5<br />
end of FC_Spects.py</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>

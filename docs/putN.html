<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>putN.cpp</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>putN.cpp</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="cp">#ifdef __cplusplus</span>
<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>
<span class="cp">#endif</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>void putN( double<em>, double</em>, double<em> , double<strong>, double</strong> , unsigned int, unsigned int</em>);</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kt">void</span> <span class="n">putN</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">length</span><span class="p">,</span> <span class="kt">double</span><span class="o">**</span> <span class="n">intens</span><span class="p">,</span> <span class="kt">double</span><span class="o">**</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">double</span><span class="o">**</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>double<em><em> putN( double</em> intens, double</em> freq, int* mode, unsigned int n, unsigned int len);</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="cp">#ifdef __cplusplus</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">transition</span><span class="p">{</span>
   <span class="kt">double</span> <span class="n">intens</span><span class="p">;</span>
   <span class="kt">double</span> <span class="n">freq</span><span class="p">;</span>
   <span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">mode</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Spect</span><span class="p">{</span>
   <span class="n">vector</span><span class="o">&lt;</span><span class="n">transition</span><span class="o">&gt;</span> <span class="n">trans</span><span class="p">;</span>

   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">n</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">){</span><span class="k">return</span> <span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mode</span><span class="p">.</span><span class="n">size</span><span class="p">();}</span>
   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">size</span><span class="p">(){</span><span class="k">return</span> <span class="n">trans</span><span class="p">.</span><span class="n">size</span><span class="p">();}</span>
   <span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">transition</span> <span class="n">newtrans</span><span class="p">){</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">trans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">newtrans</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="n">transition</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">){</span>
     <span class="k">return</span> <span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
   <span class="p">}</span>
   <span class="kt">void</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Spect</span> <span class="n">rhs</span><span class="p">){</span>
      <span class="n">trans</span><span class="o">=</span><span class="n">rhs</span><span class="p">.</span><span class="n">trans</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kt">void</span> <span class="n">print</span><span class="p">(){</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
         <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">intens</span><span class="o">&lt;&lt;</span><span class="s">&quot;   &quot;</span><span class="p">;</span>
         <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">freq</span><span class="o">&lt;&lt;</span><span class="s">&quot;   &quot;</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="s">&quot; &quot;</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">};</span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">min</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span> <span class="p">){</span>
   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">min</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
   <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="n">min</span><span class="o">&gt;</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
         <span class="n">min</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">min</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Spect</span> <span class="nf">putN1</span><span class="p">(</span> <span class="n">Spect</span> <span class="n">opa</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">){</span>
   <span class="n">Spect</span> <span class="n">npa</span><span class="p">;</span>
   <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">n</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
   <span class="n">opa</span><span class="p">.</span><span class="n">print</span><span class="p">();</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>parallelise this loop:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="cp">#pragma omp parallel for</span>
   <span class="k">for</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">opa</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">opa</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">intens</span><span class="o">&lt;</span><span class="mf">5e-6</span><span class="p">)</span>
         <span class="k">continue</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>be carefull that only one process writes at the same time</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="cp">#pragma omp critical</span>
      <span class="n">npa</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">opa</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span>
         <span class="k">continue</span><span class="p">;</span>
      <span class="n">Spect</span> <span class="n">tempSpect</span><span class="p">;</span>
      <span class="n">tempSpect</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">opa</span><span class="p">(</span><span class="n">i</span><span class="p">));</span> <span class="c1">// add one transition, all combinations with it later.</span>
      <span class="n">transition</span> <span class="n">tempTrans</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">opa</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>add all possible combinations with previously computed</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>         <span class="k">if</span> <span class="p">(</span><span class="n">opa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span> <span class="c1">//opa[j].mode.size()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>if transition j is already a combination transition</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">continue</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">opa</span><span class="p">(</span><span class="n">j</span><span class="p">).</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>no combinations with 0-0 transitions</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">continue</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="kt">bool</span> <span class="n">equal</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span>
         <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">opa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">k</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>no combinations with transitions where current transition is involved.
Also, take care that no combination is counted twice, therefore 
  skip this if the involved modes are larger than those to come.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>               <span class="n">equal</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span>
               <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">equal</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>else: i /j are valid combination:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>         <span class="n">tempTrans</span><span class="p">.</span><span class="n">intens</span><span class="o">=</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">intens</span><span class="o">*</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">intens</span><span class="p">;</span>
         <span class="n">tempTrans</span><span class="p">.</span><span class="n">freq</span><span class="o">=</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">freq</span><span class="o">+</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">freq</span><span class="p">;</span>
         <span class="n">tempTrans</span><span class="p">.</span><span class="n">mode</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">opa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">opa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
         <span class="n">assert</span><span class="p">(</span><span class="n">tempTrans</span><span class="p">.</span><span class="n">mode</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">==</span><span class="n">opa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// assured by first if() condition.</span>
         <span class="n">tempTrans</span><span class="p">.</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// opa.n(j)==1</span>
         <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">opa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">k</span><span class="o">++</span><span class="p">){</span>
            <span class="n">tempTrans</span><span class="p">.</span><span class="n">mode</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
         <span class="p">}</span>
         <span class="n">tempSpect</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">tempTrans</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>now, overwrite array tempSpect with the computed combinations.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="p">}</span>
      <span class="n">tempSpect</span><span class="o">=</span><span class="n">putN1</span><span class="p">(</span><span class="n">tempSpect</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>be carefull that only one process writes at the same time</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="cp">#pragma omp critical</span>
      <span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>tempSpect(0)=npa(i), therefore leave it away!</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">tempSpect</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
         <span class="n">npa</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">tempSpect</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">npa</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Spect</span> <span class="nf">putN2</span><span class="p">(</span> <span class="n">Spect</span> <span class="n">n_1pa</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">Spect</span> <span class="n">opa</span><span class="p">){</span>
   <span class="n">Spect</span> <span class="n">npa</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>std::cout&lt;&lt;n&lt;&lt;std::endl;
n_1pa.print();
parallelise this loop:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="cp">#pragma omp parallel for</span>
   <span class="k">for</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">n_1pa</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">n_1pa</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">intens</span><span class="o">&lt;</span><span class="mf">5e-6</span><span class="p">)</span>
         <span class="k">continue</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>be carefull that only one process writes at the same time</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="cp">#pragma omp critical</span>
      <span class="n">npa</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">n_1pa</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span>
         <span class="k">continue</span><span class="p">;</span>
      <span class="n">Spect</span> <span class="n">tempSpect</span><span class="p">;</span>
      <span class="n">transition</span> <span class="n">tempTrans</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">opa</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>add all possible combinations with previously computed</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>         <span class="k">if</span> <span class="p">(</span><span class="n">opa</span><span class="p">(</span><span class="n">j</span><span class="p">).</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>no combinations with 0-0 transitions</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="k">continue</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="kt">bool</span> <span class="n">equal</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span>
         <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">n_1pa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">k</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">n_1pa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>no combinations with transitions where current transition is involved.
Also, take care that no combination is counted twice, therefore 
  skip this if the involved modes are smaller than those to come.
Also takes care that no combination with 0 is done.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>               <span class="n">equal</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span>
               <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">equal</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>else: i /j are valid combination:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>         <span class="n">tempTrans</span><span class="p">.</span><span class="n">intens</span><span class="o">=</span><span class="n">n_1pa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">intens</span><span class="o">*</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">intens</span><span class="p">;</span>
         <span class="n">tempTrans</span><span class="p">.</span><span class="n">freq</span><span class="o">=</span><span class="n">n_1pa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">freq</span><span class="o">+</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">freq</span><span class="p">;</span>
         <span class="n">tempTrans</span><span class="p">.</span><span class="n">mode</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n_1pa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
         <span class="n">tempTrans</span><span class="p">.</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">opa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// opa.n(j)==1</span>
         <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">n_1pa</span><span class="p">.</span><span class="n">n</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">k</span><span class="o">++</span><span class="p">){</span>
            <span class="n">tempTrans</span><span class="p">.</span><span class="n">mode</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">n_1pa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mode</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
         <span class="p">}</span>
         <span class="n">tempSpect</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">tempTrans</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>now, overwrite array tempSpect with the computed combinations.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tempSpect</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span>
         <span class="n">tempSpect</span><span class="o">=</span><span class="n">putN2</span><span class="p">(</span><span class="n">tempSpect</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">opa</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>be carefull that only one process writes at the same time</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>         <span class="cp">#pragma omp critical</span>
         <span class="p">{</span>
         <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">tempSpect</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
            <span class="n">npa</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">tempSpect</span><span class="p">(</span><span class="n">k</span><span class="p">));</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">npa</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">putN</span><span class="p">(</span> <span class="kt">int</span><span class="o">*</span> <span class="n">length</span><span class="p">,</span> <span class="kt">double</span><span class="o">**</span> <span class="n">intens</span><span class="p">,</span> <span class="kt">double</span><span class="o">**</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">double</span><span class="o">**</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">){</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>set-up new variables</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">Spect</span> <span class="n">opa</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">leng</span> <span class="o">=</span> <span class="o">*</span><span class="n">length</span> <span class="p">;</span>
   <span class="kt">double</span><span class="o">*</span> <span class="n">opa_int</span> <span class="o">=</span> <span class="o">*</span><span class="n">intens</span><span class="p">;</span>
   <span class="kt">double</span><span class="o">*</span> <span class="n">opa_fre</span> <span class="o">=</span> <span class="o">*</span><span class="n">freq</span><span class="p">;</span>
   <span class="kt">double</span><span class="o">*</span> <span class="n">opa_mod</span> <span class="o">=</span> <span class="o">*</span><span class="n">mode</span><span class="p">;</span>
   <span class="n">transition</span> <span class="n">trans</span><span class="p">;</span>
   <span class="n">trans</span><span class="p">.</span><span class="n">mode</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>add given quantities into structures needed here:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">leng</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="n">trans</span><span class="p">.</span><span class="n">intens</span><span class="o">=</span><span class="n">opa_int</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">trans</span><span class="p">.</span><span class="n">freq</span><span class="o">=</span><span class="n">opa_fre</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">trans</span><span class="p">.</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">opa_mod</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">opa</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">trans</span><span class="p">);</span>
   <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>std::cout&lt;&lt;"OPA:"&lt;&lt;std::endl;
opa.print();
calculate n-particle spectrum:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">Spect</span> <span class="n">npa</span><span class="o">=</span><span class="n">putN2</span><span class="p">(</span><span class="n">opa</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">opa</span><span class="p">);</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>std::cout&lt;&lt;std::endl;
std::cout&lt;&lt;"NPA:"&lt;&lt;std::endl;
npa.print();</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   
   <span class="n">leng</span><span class="o">=</span><span class="n">npa</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
   <span class="kt">double</span><span class="o">*</span> <span class="n">npa_int</span><span class="p">,</span> <span class="o">*</span> <span class="n">npa_fre</span> <span class="p">;</span>
   <span class="n">npa_int</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="o">*</span> <span class="n">leng</span><span class="p">);</span>
   <span class="n">npa_fre</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="o">*</span> <span class="n">leng</span><span class="p">);</span>
   <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">leng</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="n">npa_int</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">npa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">intens</span><span class="p">;</span>
      <span class="n">npa_fre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">npa</span><span class="p">.</span><span class="n">trans</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">freq</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="o">*</span><span class="n">length</span><span class="o">=</span><span class="n">leng</span><span class="p">;</span>
   <span class="o">*</span><span class="n">intens</span><span class="o">=</span><span class="n">npa_int</span><span class="p">;</span>
   <span class="o">*</span><span class="n">freq</span> <span class="o">=</span> <span class="n">npa_fre</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>

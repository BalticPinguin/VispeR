<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>broaden.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>broaden.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>filename: broadening.py</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">re</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Below are the conversion factors and fundamental constant</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">handel_input</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
   <span class="n">gridfile</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span> <span class="c">#by default: only slight broadening</span>
   <span class="n">gridpt</span><span class="o">=</span><span class="mi">5000</span>
   <span class="n">omega</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">minfreq</span><span class="o">=</span><span class="mi">0</span>
   <span class="n">maxfreq</span><span class="o">=</span><span class="mi">0</span>
   <span class="n">shape</span><span class="o">=</span><span class="s">&#39;g&#39;</span>
   <span class="n">spectfile</span><span class="o">=</span><span class="bp">None</span>

   <span class="n">tmpgrid</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?&lt;=grid=)[ \=\s\w\.,]+&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpgrid</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>i.e. if grid is specified</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">grid</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;[\w\.]+&quot;</span><span class="p">,</span> <span class="n">tmpgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
	 <span class="k">try</span><span class="p">:</span>
	    <span class="n">gridpt</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	 <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="c"># if grid is no a number</span>
	    <span class="n">gridfile</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
	 <span class="n">gridpt</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	 <span class="n">minfreq</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	 <span class="n">maxfreq</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">gridfile</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>read file in format of linspect</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="n">grid</span><span class="o">=</span><span class="p">[]</span>
	 <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gridfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
	    <span class="n">lis</span><span class="o">=</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>  <span class="c"># create a list of lists</span>
	    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lis</span><span class="p">):</span>        <span class="c">#print the list items </span>
	       <span class="n">grid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
	 <span class="n">omega</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>
	 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">)):</span>
	    <span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;(?&lt;=gamma=)[ \d\.,]+&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>  <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">gamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">shape</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?&lt;=shape=)[ \w]+&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;lorentzian&quot;</span><span class="p">,</span> <span class="s">&quot;Lorentzian&quot;</span><span class="p">,</span> <span class="s">&quot;L&quot;</span><span class="p">,</span> <span class="s">&quot;l&quot;</span><span class="p">]:</span>
	 <span class="n">shape</span><span class="o">=</span><span class="s">&quot;l&quot;</span>
      <span class="k">elif</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;gaussian&quot;</span><span class="p">,</span> <span class="s">&quot;Gaussian&quot;</span><span class="p">,</span> <span class="s">&quot;G&quot;</span><span class="p">,</span> <span class="s">&quot;g&quot;</span><span class="p">]:</span>
	 <span class="n">shape</span><span class="o">=</span><span class="s">&quot;g&quot;</span>
   <span class="k">return</span> <span class="n">omega</span><span class="p">,</span> <span class="n">spectfile</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gridpt</span><span class="p">,</span> <span class="n">minfreq</span><span class="p">,</span> <span class="n">maxfreq</span><span class="p">,</span> <span class="n">shape</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>This function is a generalisation of OPA2TPA and OPA23PA to arbitrary particle numbers.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">OPA2nPA</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">,</span><span class="n">freq00</span><span class="p">,</span> <span class="n">OPAintens</span><span class="p">,</span> <span class="n">intens00</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p><strong>PARAMETERS</strong>
  OPAfreq:  frequencies of transitions in OPA. (Frequencies of modes * number of quanta in change)
     array of lenght n
  freq00:   frequency of purely electronic transition
  OPAintens:intensities of the respective transitions in same order as OPAfreq
  intens00: intensity of the purely electronic transition
     array of lenght n
  mode: number of vibrational states changing
     array of lenght n</p>
<p><strong>RETURNS</strong>
  TPAfreq:  </p>
<p>TPAfreq:  frequencies of the nPA-vibrational spectrum
  TPAintens:intensities of the nPA-vibrational spectrum </p>
<p>This function does the most calculation that is the iteration to the next number of particles</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">putN</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">OPAintens</span><span class="p">,</span> <span class="n">OPAfreq</span><span class="p">,</span> <span class="n">oldmode</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">newintens</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">newfreq</span><span class="o">=</span><span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>print 'arrived here:', mode, oldmode, n ,'-------------------'</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intens</span><span class="p">)):</span>
	 <span class="k">if</span> <span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.000</span><span class="p">:</span> <span class="c">#######</span>
	    <span class="n">newintens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c">#this is OPA-part</span>
	    <span class="n">newfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	    <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
	       <span class="k">continue</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>this saves creating new objects and running through loops without having results</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	    <span class="n">tmpintens</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">tmpfreq</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">newmode</span><span class="o">=</span><span class="p">[]</span>
	    <span class="n">nwemode</span><span class="o">=</span><span class="p">[]</span>
	    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldmode</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span> <span class="c"># go through whole range of states ...</span>
	       <span class="n">tmpmode</span><span class="o">=</span><span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">[:]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">oldmode</span><span class="p">[:]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">p</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>tmpmode=list(set(mode[:].T[i]).difference(oldmode[:].T[k]))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	       <span class="k">if</span> <span class="n">tmpmode</span><span class="o">==</span><span class="p">[]:</span>
		  <span class="k">continue</span>
	       <span class="n">tempmode</span><span class="o">=</span><span class="n">oldmode</span><span class="p">[:]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
	       <span class="k">if</span> <span class="n">tempmode</span><span class="o">==</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>that means, if mode[:].T[k] contains 0-0 transition</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		  <span class="k">continue</span>
	       <span class="k">try</span> <span class="p">:</span>
		  <span class="n">tmpmode</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmpmode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>print tmpmode</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		  <span class="n">xmode</span><span class="o">=</span><span class="p">[]</span>
		  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmpmode</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
		     <span class="n">xmode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpmode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <h3>how to change rows and columns in a list?</h3>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		  <span class="n">newmode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xmode</span><span class="p">)</span> <span class="c">#or xmode.T??</span>
	       <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
		  <span class="n">newmode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tmpmode</span><span class="p">))</span>
	       <span class="n">nwemode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempmode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>print "new modes:\n", newmode, nwemode, k</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	       <span class="n">tmpintens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	       <span class="n">tmpfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpintens</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	       <span class="n">xmode</span><span class="o">=</span><span class="p">[]</span>
	       <span class="n">xmode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newmode</span><span class="p">)</span>
	       <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xmode</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
		  <span class="n">xmode</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">xmode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>print 'what I want:', xmode, np.shape(xmode)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>		  <span class="n">nmode</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span> <span class="nb">len</span><span class="p">(</span><span class="n">xmode</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xmode</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">))</span>
		  <span class="n">nmode</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">xmode</span>
		  <span class="n">nmode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">nwemode</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>print 'what I finally get:', nmode</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	       <span class="k">else</span><span class="p">:</span>
		  <span class="n">xmode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nwemode</span><span class="p">)</span>
		  <span class="n">nmode</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">xmode</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>print "submitting:\n", nmode
print tmpfreq</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	       <span class="n">freq2</span><span class="p">,</span> <span class="n">intens2</span><span class="o">=</span><span class="n">putN</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tmpintens</span><span class="p">,</span> <span class="n">tmpfreq</span><span class="p">,</span> <span class="n">nmode</span><span class="p">,</span> <span class="n">OPAintens</span><span class="p">,</span> <span class="n">OPAfreq</span><span class="p">,</span> <span class="n">oldmode</span><span class="p">)</span>
	       <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intens2</span><span class="p">)):</span>
		  <span class="n">newintens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intens2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
		  <span class="n">newfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">newfreq</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">newintens</span><span class="p">)</span>
	
   <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
      <span class="n">OPAfreq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-=</span><span class="n">freq00</span>
      <span class="n">OPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/=</span><span class="n">intens00</span>
   <span class="n">newmode</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mode</span><span class="p">)))</span> <span class="c">#for n&gt;1: matrix-structure needed</span>
   <span class="n">newmode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">mode</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>print 'mode:\n', newmode</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">TPAfreq</span><span class="p">,</span> <span class="n">TPAintens</span><span class="o">=</span><span class="n">putN</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">OPAintens</span><span class="p">,</span> <span class="n">OPAfreq</span><span class="p">,</span> <span class="n">newmode</span><span class="p">,</span> <span class="n">OPAintens</span><span class="p">,</span> <span class="n">OPAfreq</span><span class="p">,</span> <span class="n">newmode</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAfreq</span><span class="p">)):</span>
      <span class="n">TPAfreq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+=</span><span class="n">freq00</span>
      <span class="n">TPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*=</span><span class="n">intens00</span>
   <span class="k">return</span> <span class="n">TPAfreq</span><span class="p">,</span> <span class="n">TPAintens</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">OPA2TPA</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">,</span><span class="n">freq00</span><span class="p">,</span> <span class="n">OPAintens</span><span class="p">,</span><span class="n">intens00</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
   <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">)</span>
   <span class="n">TPAfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">length</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="n">length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">#this is overestimation of size...</span>
   <span class="n">TPAintens</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">length</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="n">length</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
   <span class="n">TPAintens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">intens00</span> <span class="c">#this is OPA-part</span>
   <span class="n">TPAfreq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">freq00</span>
   <span class="n">ind</span><span class="o">=</span><span class="mi">1</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>0-0 transition is included, but only once! (before)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="k">continue</span>
      <span class="n">TPAintens</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c">#this is OPA-part</span>
      <span class="n">TPAfreq</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>print i, TPAfreq[ind]-freq00, TPAintens[ind]/intens00</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">ind</span><span class="o">+=</span><span class="mi">1</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">length</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <h1>not only same mode but all modes with lower number should not be taken into account here!?</h1>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">mode</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mode</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c">#both have same mode... or mode[j] is 0-0 transition</span>
	    <span class="k">continue</span>
	 <span class="n">TPAintens</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">intens00</span>
	 <span class="n">TPAfreq</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">freq00</span>
	 <span class="n">ind</span><span class="o">+=</span><span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>print mode[i], mode[j]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">TPAfreq</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;heapsort&#39;</span><span class="p">)</span>
   <span class="n">TPAfreq</span><span class="o">=</span><span class="n">TPAfreq</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
   <span class="n">TPAintens</span><span class="o">=</span><span class="n">TPAintens</span><span class="p">[</span><span class="n">index</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>for i in range(len(TPAfreq)):
print TPAfreq[i], TPAintens[i]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">return</span> <span class="n">TPAfreq</span><span class="p">,</span> <span class="n">TPAintens</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">OPA23PA</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">,</span><span class="n">freq00</span><span class="p">,</span> <span class="n">OPAintens</span><span class="p">,</span><span class="n">intens00</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
   <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">)</span>
   <span class="n">TPAfreq</span><span class="o">=</span><span class="p">[]</span><span class="c">#np.zeros((((length+1)*(length+2)+3)*(length+3))//6+length+1) #this is overestimation of size...</span>
   <span class="n">TPAintens</span><span class="o">=</span><span class="p">[]</span>
   <span class="n">TPAintens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intens00</span><span class="p">)</span> <span class="c">#this is OPA-part</span>
   <span class="n">TPAfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq00</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>0-0 transition is included, but only once!</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="k">continue</span>
      <span class="n">TPAintens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c">#this is OPA-part</span>
      <span class="n">TPAfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">length</span><span class="p">):</span>
	 <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">mode</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mode</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c">#both have same mode... or mode[j] is 0-0 transition</span>
	    <span class="k">continue</span>
	 <span class="n">TPAintens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">intens00</span><span class="p">)</span>
	 <span class="n">TPAfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">freq00</span><span class="p">)</span>
	 <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">length</span><span class="p">):</span>
	    <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="n">mode</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="n">mode</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c">#both have same mode...</span>
	       <span class="k">continue</span>
	    <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="n">mode</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
	       <span class="k">continue</span>
	    <span class="n">TPAintens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">OPAintens</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">intens00</span><span class="o">*</span><span class="n">intens00</span><span class="p">))</span>
	    <span class="n">TPAfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">OPAfreq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">freq00</span><span class="p">)</span>
   <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAfreq</span><span class="p">))</span>
   <span class="n">intens</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAintens</span><span class="p">))</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)):</span> <span class="c">#this can not be done by np.matrix() due to dimensionality...</span>
	<span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">TPAfreq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">TPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
   <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">intens</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>This function calculates the broadened spectrum given the line spectrum,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">outspect</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">linspect</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>frequency-rage and output-file whose name is first argument. 
As basis-function a Lorentzian is assumed with a common width.</p>
<p><strong>PARAMETERS:</strong>
spectfile: file, the result is written in (ascii-table). 
In addition a graph is created and shown on the fly. This graph is not saved.
gridpt:    number of grid-points to be used for the calculation
linspect:  line-spectrum list (frequency, intensity) 
gamma:     broadening constant for the Lorentzians. It is the same for all peaks</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">omega</span><span class="p">,</span> <span class="n">spectfile</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">gridpt</span><span class="p">,</span> <span class="n">minfreq</span><span class="p">,</span> <span class="n">maxfreq</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span><span class="n">handel_input</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>read file in format of linspect</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>sort spectrum with respect to size of elements</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;heapsort&#39;</span><span class="p">)</span>
   <span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="c">#intensity</span>
   <span class="n">linspect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="c">#mode</span>
   <span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="c">#frequency</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>find transition with minimum intensity to be respected</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">minint</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
      <span class="k">if</span> <span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.0001</span><span class="o">*</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
	 <span class="n">minint</span><span class="o">=</span><span class="n">i</span>
	 <span class="k">break</span>
   <span class="k">if</span> <span class="n">logging</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
      <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;neglect &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">minint</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; transitions, use only &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">minint</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; instead.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">logging</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
	 <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;minimal and maximal intensities:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">minint</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>make nPA from OPA:</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;to [\d]PA&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">n</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?&lt;=to )[\d](?=PA)&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;2&#39;</span><span class="p">:</span>
	 <span class="n">ind</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <pre><code>                     spectral frequency   0-0 transition      intensities          0-0 intensit.          modes
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="n">TPAf</span><span class="p">,</span> <span class="n">TPAi</span><span class="o">=</span><span class="n">OPA2TPA</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">minint</span><span class="p">:],</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="p">,</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">minint</span><span class="p">:],</span> <span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> 
											     <span class="n">linspect</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">minint</span><span class="p">:])</span>
	 <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">TPAi</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;heapsort&#39;</span><span class="p">)</span>
	 <span class="n">TPAi</span><span class="o">=</span><span class="n">TPAi</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="c">#resort by intensity</span>
	 <span class="n">TPAf</span><span class="o">=</span><span class="n">TPAf</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	 <span class="n">minint</span><span class="o">=</span><span class="mi">0</span>
	 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAi</span><span class="p">)):</span>
	    <span class="k">if</span> <span class="n">TPAi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.0001</span><span class="o">*</span><span class="n">TPAi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
	       <span class="n">minint</span><span class="o">=</span><span class="n">i</span>
	       <span class="k">break</span>
	 <span class="k">if</span> <span class="n">logging</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
   	    <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;for TPA: again neglect &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">minint</span><span class="p">)</span><span class="o">+</span>
		     <span class="s">&#39; transitions, use only &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAi</span><span class="p">)</span><span class="o">-</span><span class="n">minint</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; instead.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
	 <span class="n">TPAintens</span><span class="o">=</span><span class="n">TPAi</span><span class="p">[</span><span class="n">minint</span><span class="p">:]</span>
	 <span class="n">TPAfreq</span><span class="o">=</span><span class="n">TPAf</span><span class="p">[</span><span class="n">minint</span><span class="p">:]</span>
      <span class="k">elif</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;3&#39;</span><span class="p">:</span>
	 <span class="n">ind</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
	 <span class="n">TPAfreq</span><span class="p">,</span> <span class="n">TPAintens</span><span class="o">=</span><span class="n">OPA2TPA</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">minint</span><span class="p">:],</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="p">,</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">minint</span><span class="p">:],</span> 
			      <span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> <span class="n">linspect</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">minint</span><span class="p">:])</span>
	 <span class="n">minint</span><span class="o">=</span><span class="mi">0</span>
	 <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">TPAintens</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;heapsort&#39;</span><span class="p">)</span>
	 <span class="n">TPAintens</span><span class="o">=</span><span class="n">TPAintens</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="c">#resort by intensity</span>
	 <span class="n">TPAfreq</span><span class="o">=</span><span class="n">TPAfreq</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAintens</span><span class="p">)):</span>
	    <span class="k">if</span> <span class="n">TPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.0001</span><span class="o">*</span><span class="n">TPAintens</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
	       <span class="n">minint</span><span class="o">=</span><span class="n">i</span>
	       <span class="k">break</span>
	 <span class="k">if</span> <span class="n">logging</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
	    <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;for 3PA: again neglect &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">minint</span><span class="p">)</span><span class="o">+</span>
		     <span class="s">&#39; transitions, use only &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAintens</span><span class="p">)</span><span class="o">-</span><span class="n">minint</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; instead.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
	 <span class="n">TPAintens</span><span class="o">=</span><span class="n">TPAintens</span><span class="p">[</span><span class="n">minint</span><span class="p">:]</span> <span class="c">#resort by intensity</span>
	 <span class="n">TPAfreq</span><span class="o">=</span><span class="n">TPAfreq</span><span class="p">[</span><span class="n">minint</span><span class="p">:]</span>
      <span class="k">elif</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
	 <span class="n">TPAfreq</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">minint</span><span class="p">:]</span>
	 <span class="n">TPAintens</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">minint</span><span class="p">:]</span>
      <span class="k">else</span><span class="p">:</span>
	 <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;to &lt;n&gt;PA was given but not recognised.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">n</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?&lt;=to nPA:)[ \d]*&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="p">[]:</span>
	 <span class="n">TPAfreq</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">minint</span><span class="p">:]</span>
	 <span class="n">TPAintens</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">minint</span><span class="p">:]</span>
      <span class="k">else</span><span class="p">:</span>
	 <span class="n">n</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	 <span class="n">ind</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <pre><code>                     spectral frequency   0-0 transition      intensities          0-0 intensit.          modes
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="n">TPAfreq</span><span class="p">,</span> <span class="n">TPAintens</span><span class="o">=</span><span class="n">OPA2nPA</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">minint</span><span class="p">:],</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="p">,</span><span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">minint</span><span class="p">:],</span> <span class="n">linspect</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">],</span> 
											     <span class="n">linspect</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">minint</span><span class="p">:],</span> <span class="n">n</span><span class="p">)</span>
	 <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">TPAintens</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;heapsort&#39;</span><span class="p">)</span>
	 <span class="n">TPAintens</span><span class="o">=</span><span class="n">TPAintens</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="c">#resort by intensity</span>
	 <span class="n">TPAfreq</span><span class="o">=</span><span class="n">TPAfreq</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	 <span class="n">minint</span><span class="o">=</span><span class="mi">0</span>
	 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAintens</span><span class="p">)):</span>
	    <span class="k">if</span> <span class="n">TPAintens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.00005</span><span class="o">*</span><span class="n">TPAintens</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
	       <span class="n">minint</span><span class="o">=</span><span class="n">i</span>
	       <span class="k">break</span>
	 <span class="k">if</span> <span class="n">logging</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
	    <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;for {0}PA: again neglect {1} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">minint</span><span class="p">)</span><span class="o">+</span>
		     <span class="s">&#39; transitions, use only &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TPAintens</span><span class="p">)</span><span class="o">-</span><span class="n">minint</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; instead.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
	 <span class="n">TPAintens</span><span class="o">=</span><span class="n">TPAintens</span><span class="p">[</span><span class="n">minint</span><span class="p">:]</span> <span class="c">#resort by intensity</span>
	 <span class="n">TPAfreq</span><span class="o">=</span><span class="n">TPAfreq</span><span class="p">[</span><span class="n">minint</span><span class="p">:]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>find transition with minimum intensity to be respected
the range of frequency ( should be greater than the transition-frequencies)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">if</span> <span class="n">omega</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">minfreq</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
	 <span class="n">minfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">TPAfreq</span><span class="p">)</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="n">gamma</span>
      <span class="k">if</span> <span class="n">maxfreq</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
	 <span class="n">maxfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">TPAfreq</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">+</span><span class="n">gamma</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">minfreq</span><span class="o">=</span><span class="n">omega</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">maxfreq</span><span class="o">=</span><span class="n">omega</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
   <span class="k">if</span> <span class="n">logging</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
      <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;maximal and minimal frequencies:</span><span class="se">\n</span><span class="s"> {0} {1}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maxfreq</span><span class="p">,</span> <span class="n">minfreq</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>if no other grid is defined: use linspace in range</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">if</span> <span class="n">omega</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
      <span class="n">omega</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minfreq</span><span class="p">,</span><span class="n">maxfreq</span><span class="p">,</span><span class="n">gridpt</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">logging</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
	 <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;omega is equally spaced</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
   <span class="n">spect</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">))</span>
   <span class="n">sigma</span><span class="o">=</span><span class="n">gamma</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.355</span> <span class="c">#if gaussian used: same FWHM</span>

   <span class="n">TPAintens</span><span class="o">/=</span><span class="n">TPAintens</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="c">#normalise spectrum (due to highest peak) to make different approaches comparable</span>

   <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">TPAfreq</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;heapsort&#39;</span><span class="p">)</span> <span class="c">#sort by freq</span>
   <span class="n">freq</span><span class="o">=</span><span class="n">TPAfreq</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
   <span class="n">intens</span><span class="o">=</span><span class="n">TPAintens</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
   <span class="k">if</span> <span class="n">logging</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
      <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;intensity   frequency</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intens</span><span class="p">)):</span>
	 <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">u&quot;{0} {1}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

   <span class="n">mini</span><span class="o">=</span><span class="mi">0</span>
   <span class="n">maxi</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="c">#just in case Gamma is too big or frequency-range too low</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">5</span><span class="o">*</span><span class="n">gamma</span><span class="o">+</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
	 <span class="n">maxi</span><span class="o">=</span><span class="n">i</span>
	 <span class="k">break</span>
   <span class="k">if</span> <span class="n">spectfile</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
      <span class="n">spectfile</span><span class="o">=</span><span class="s">&quot;/dev/null&quot;</span> <span class="c">#discart spectrum</span>
   <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">spectfile</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
   <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;broadened spectrum:</span><span class="se">\n</span><span class="s"> frequency      intensity</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">shape</span><span class="o">==</span><span class="s">&#39;g&#39;</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">)):</span> 
     	 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxi</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)):</span>
   	    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">5</span><span class="o">*</span><span class="n">gamma</span><span class="o">+</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
   	       <span class="n">maxi</span><span class="o">=</span><span class="n">j</span>
   	       <span class="k">break</span>
	 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mini</span><span class="p">),</span><span class="n">maxi</span><span class="p">):</span>
   	    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">gamma</span><span class="p">:</span>
   	       <span class="n">mini</span><span class="o">=</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span>
   	       <span class="k">break</span>
	 <span class="n">spect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">intens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span>\
		  <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">freq</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">freq</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span><span class="n">sigma</span><span class="p">))</span>
		  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>out.write(u" {0}  {1}\n".format(omega[i] ,spect[i]))</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">u&quot; {0}  {1}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">,</span><span class="n">spect</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
   <span class="k">else</span><span class="p">:</span>  <span class="c">#shape==&#39;l&#39;:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega</span><span class="p">)):</span> 
	 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxi</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)):</span>
	    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">5</span><span class="o">*</span><span class="n">gamma</span><span class="o">+</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
	       <span class="n">maxi</span><span class="o">=</span><span class="n">j</span>
	       <span class="k">break</span>
     	 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mini</span><span class="p">),</span><span class="n">maxi</span><span class="p">):</span>
	    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="n">gamma</span><span class="p">:</span>
	       <span class="n">mini</span><span class="o">=</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span>
	       <span class="k">break</span>
	 <span class="n">spect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">intens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gamma</span><span class="o">/</span><span class="p">((</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">freq</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">freq</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">+</span><span class="n">gamma</span><span class="o">*</span><span class="n">gamma</span><span class="p">)</span>
		  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span><span class="p">))</span>
	 <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">u&quot; {0}  {1}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">,</span><span class="n">spect</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
	 <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">u&quot; {0}  {1}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">omega</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">,</span><span class="n">spect</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
   <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">version</span><span class="o">=</span><span class="mf">1.2</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>End of broadening.py</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>

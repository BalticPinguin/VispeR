<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>OPA.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>OPA.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="n">Hartree2cm_1</span><span class="o">=</span><span class="mf">219474.63</span> 
<span class="n">Threshold</span><span class="o">=</span><span class="mf">3e-10</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">OPA</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>initializes the class</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">L</span><span class="p">):</span> <span class="c">#should it be __new__?</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">assert</span> <span class="n">alpha</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;There must be at least one degree of freedom!&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">alpha</span><span class="p">,</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="c">#change elements to some float32 or so...</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">FC</span><span class="p">):</span>
      <span class="n">exc</span><span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">exc</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	 <span class="n">index</span><span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
	 <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">exc</span><span class="p">]</span><span class="o">=</span><span class="n">FC</span>
      <span class="k">else</span><span class="p">:</span>
	 <span class="n">index</span><span class="o">=</span><span class="n">N</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
	 <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">FC</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">getState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span> 
      <span class="n">exc</span><span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">exc</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	 <span class="n">index</span><span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
	 <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">exc</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
	 <span class="n">index</span><span class="o">=</span><span class="n">N</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
	 <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c">#extract all elements </span>
      <span class="n">intens</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">ind</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">excs</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">)):</span>
	 <span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
	    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">exc</span><span class="p">]</span><span class="o">&gt;</span><span class="n">Threshold</span><span class="p">:</span>
   	       <span class="n">intens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">exc</span><span class="p">])</span>
   	       <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
   	       <span class="n">excs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>print "diff", self.mat[index][exc],self.mat[index][-exc] #this should, in principle, coincide --&gt; does!</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">return</span> <span class="n">intens</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">excs</span> <span class="c">#I need squares as intensities</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Calculates the FC-factors for given Duschinsky-effect. No restriction to OPA</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">simpleFCfOPA</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span><span class="n">E0</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p><em>PARAMETERS:</em>
J:      Duschisky-matrix
K:      Displacement-Vector
f:      frequency: two-dim array (freq_initial, freq_final)
Energy: Energy-difference of minima
N:      Max. number of excitation quanta state considered
T:      temperature of the system (in atomic units)
E0:     relative energy with respect to lowest triplet state</p>
<p>All arguments are obligatory.</p>
<p><em>RETURNS:</em>
linespectrum </p>
<p>This function calculates the overlap-integral for zero vibrations</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">CalcI00</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">opa</span><span class="o">=</span><span class="n">OPA</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c">#is this clear to be the respective class?</span>
      <span class="n">zeros</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dim</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zeros</span><span class="p">)):</span> <span class="c">#insert this transition into all values... important for recursion...</span>
	 <span class="n">zeros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
	 <span class="n">opa</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">zeros</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c">#sum(sum()) due to matrix</span>
	 <span class="n">zeros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
      <span class="n">linspect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">E</span><span class="o">*</span><span class="n">Hartree2cm_1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
      <span class="k">return</span> <span class="n">opa</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Calculates the Franck-Condon factors of an eletronic transition using the lower levels L1 and L2</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">iterate</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>PARAMETERS:*
1:     binary tree where i-2 quanta are excited (structure: <a href="Btree.html">Btree.py</a>
2:     binary tree where i-1 quanta are excited
nergy: Energy-difference between the states (minimal energy)
:      number of excitation-quanta
:      (2xN) frequencies of both states
:      Duschisky-rotation matrix
:      Displacement-vector</p>
<p>RETURNS:*
2:     input-parameter (needed for next iteration)
3:     new binary tree </p>
<p>This function creates all possible states having a total number of n excitations in alpha different states</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">states</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <pre><code>
     *PARAMETERS:*
</code></pre>
<p>alpha: number of degrees of freedom
n:     number of excitations</p>
<pre><code>     *RETURNS:*
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="n">States</span><span class="o">=</span><span class="p">[]</span>
	 <span class="n">distributions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
	 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
	    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
	       <span class="n">distributions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="n">j</span>
	       <span class="n">distributions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">alpha</span><span class="p">]</span><span class="o">=</span><span class="n">j</span>
	       <span class="n">States</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distributions</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">))</span> <span class="c">#save memory!</span>
	       <span class="n">distributions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
	       <span class="n">distributions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">alpha</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
	 <span class="k">return</span> <span class="n">States</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>quantities for the iterative spectrum-calculation</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">Gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>              	<span class="c"># in atomic units. It is equivalent to 4pi^2/h f_i</span>
      <span class="n">Gammap</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>             	<span class="c"># for final state</span>
      <span class="n">sqGamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>   
      <span class="n">sqGammap</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  
      <span class="n">unity</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Gamma</span><span class="p">))</span>
   
      <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Gammap</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">+</span><span class="n">Gamma</span><span class="p">)</span> <span class="c">#C is only temporary matrix here</span>
      <span class="n">A</span><span class="o">=</span><span class="n">J</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> 
      <span class="n">A</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqGammap</span><span class="p">,</span><span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqGammap</span><span class="p">))</span><span class="o">-</span><span class="n">unity</span>
      <span class="n">TMP</span><span class="o">=</span><span class="n">J</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Gammap</span><span class="p">)</span>
      <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">sqGammap</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">unity</span><span class="o">-</span><span class="n">TMP</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
      <span class="n">d</span><span class="o">=-</span><span class="mi">2</span><span class="o">*</span><span class="n">sqGamma</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Gammap</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
      <span class="n">E</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">sqGamma</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqGammap</span><span class="p">)</span>
      <span class="n">C</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">sqGamma</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqGamma</span><span class="p">)</span><span class="o">-</span><span class="n">unity</span> 		<span class="c">#this is &#39;real&#39; C-matrix</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>initialize new OPA-object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">alpha</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">L3</span><span class="o">=</span><span class="n">OPA</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>    	  	<span class="c"># initialize root-node</span>
      <span class="n">States</span><span class="o">=</span><span class="n">states</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> 		<span class="c"># States are all possible</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">States</span><span class="p">:</span>			<span class="c">#for each possible state, described by n(vector)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>index of excited elements</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">n</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span>	<span class="c">#if there is no excitation: it returns 0</span>
	 <span class="n">I_nn</span><span class="o">=</span><span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>need first iteration formula</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
	    <span class="n">n_m</span><span class="o">=</span><span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
	    <span class="n">ntemp</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	    <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span> <span class="c">#n[m] is at least 1</span>
	    <span class="n">Ps</span><span class="o">=</span><span class="n">L2</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">:</span>
	       <span class="n">I_nn</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>					<span class="c"># first term </span>
	    <span class="k">if</span> <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	       <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
	       <span class="n">Ps</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	       <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">):</span>
		  <span class="n">I_nn</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">n_m</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>		<span class="c"># second term</span>
	    <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	       <span class="n">ntemp</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	       <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
	       <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
     	       <span class="n">Ps</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	       <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">:</span>
		  <span class="n">I_nn</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>	<span class="c"># second term</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>else: need the other iteration-formula</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="k">else</span><span class="p">:</span> 
	    <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:])</span>				<span class="c"># index of excited elements</span>
	    <span class="n">n_m</span><span class="o">=</span><span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
	    <span class="n">ntemp</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	    <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
	    <span class="n">Ps</span><span class="o">=</span><span class="n">L2</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">:</span>
	       <span class="n">I_nn</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>					<span class="c"># first term </span>
	    <span class="k">if</span> <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	       <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
	       <span class="n">Ps</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	       <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">:</span>
		  <span class="n">I_nn</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">n_m</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>        	<span class="c"># second term; all other terms vanish in OPA...</span>
     	 <span class="n">I_nn</span><span class="o">/=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_m</span><span class="p">)</span>
	 <span class="n">L3</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I_nn</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">makeLine</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span><span class="n">E0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">Gammap</span><span class="p">,</span><span class="n">E</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
      <span class="n">F</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="mi">3</span> <span class="p">))</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)):</span> 
	 <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	 <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">Gammap</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span>
   		   <span class="n">Gamma</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">+</span><span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="n">Hartree2cm_1</span>
	 <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="n">Gamma</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">ex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">E0</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
	 <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">u&quot;{1}   {0}    {2}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
   
   <span class="n">Gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">Gammap</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c"># for final state</span>

   <span class="n">linspect</span><span class="o">=</span><span class="p">[]</span>
   <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;frequency,           intensity ,      mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
   <span class="n">L2</span><span class="o">=</span><span class="n">CalcI00</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">),</span> <span class="n">Energy</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>this is already extracted to linspect (using side-effects)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">L1</span><span class="o">=</span><span class="n">L2</span> 
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="o">=</span><span class="n">iterate</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
      <span class="n">intens</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">excitation</span><span class="o">=</span><span class="n">L2</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
      <span class="n">linspect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">makeLine</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span><span class="n">intens</span><span class="p">,</span><span class="n">E0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">excitation</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">Gammap</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
   <span class="n">dimen</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">)):</span>
      <span class="n">dimen</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
   <span class="n">spect</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimen</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
   <span class="n">spect</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">dimen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">)):</span>
      <span class="n">spect</span><span class="p">[</span><span class="n">dimen</span><span class="p">:</span><span class="n">dimen</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">dimen</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
   <span class="k">return</span> <span class="n">spect</span><span class="o">.</span><span class="n">T</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Calculates the FC-factors for given Duschinsky-effect. No restriction to OPA</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">resortFCfOPA</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span><span class="n">E0</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p><em>PARAMETERS:</em>
J:      Duschisky-matrix
K:      Displacement-Vector
f:      frequency: two-dim array (freq_initial, freq_final)
Energy: Energy-difference of minima
N:      Max. number of excitation quanta state considered
T:      temperature of the system (in atomic units)
E0:     relative energy with respect to lowest triplet state</p>
<p>All arguments are obligatory.</p>
<p><em>RETURNS:</em>
linespectrum </p>
<p>This function calculates the overlap-integral for zero vibrations</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">CalcI00</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">opa</span><span class="o">=</span><span class="n">OPA</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c">#is this clear to be the respective class?</span>
      <span class="n">zeros</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dim</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zeros</span><span class="p">)):</span> <span class="c">#insert this transition into all values... important for recursion...</span>
	 <span class="n">zeros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
	 <span class="n">opa</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">zeros</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c">#sum(sum()) due to matrix</span>
	 <span class="n">zeros</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
      <span class="n">linspect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="n">E</span><span class="o">*</span><span class="n">Hartree2cm_1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
      <span class="k">return</span> <span class="n">opa</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Calculates the Franck-Condon factors of an eletronic transition using the lower levels L1 and L2</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">iterate</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>PARAMETERS:*
1:     binary tree where i-2 quanta are excited (structure: <a href="Btree.html">Btree.py</a>
2:     binary tree where i-1 quanta are excited
nergy: Energy-difference between the states (minimal energy)
:      number of excitation-quanta
:      (2xN) frequencies of both states
:      Duschisky-rotation matrix
:      Displacement-vector</p>
<p>RETURNS:*
2:     input-parameter (needed for next iteration)
3:     new binary tree </p>
<p>This function creates all possible states having a total number of n excitations in alpha different states</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="k">def</span> <span class="nf">states</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <pre><code>
     *PARAMETERS:*
</code></pre>
<p>alpha: number of degrees of freedom
n:     number of excitations</p>
<pre><code>     *RETURNS:*
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="n">States</span><span class="o">=</span><span class="p">[]</span>
	 <span class="n">distributions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
	 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
	    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
	       <span class="n">distributions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="n">j</span>
	       <span class="n">distributions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">alpha</span><span class="p">]</span><span class="o">=</span><span class="n">j</span>
	       <span class="n">States</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distributions</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">))</span> <span class="c">#save memory!</span>
	       <span class="n">distributions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
	       <span class="n">distributions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">alpha</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
	 <span class="k">return</span> <span class="n">States</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>quantities for the iterative spectrum-calculation</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">Gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>              	<span class="c"># in atomic units. It is equivalent to 4pi^2/h f_i</span>
      <span class="n">Gammap</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>             	<span class="c"># for final state</span>
      <span class="n">sqGamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>   
      <span class="n">sqGammap</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  
      <span class="n">unity</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Gamma</span><span class="p">))</span>
   
      <span class="n">C</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Gammap</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="p">)</span><span class="o">+</span><span class="n">Gamma</span><span class="p">)</span> 	<span class="c">#C is only temporary matrix here</span>
      <span class="n">A</span><span class="o">=</span><span class="n">J</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> 
      <span class="n">A</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqGammap</span><span class="p">,</span><span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqGammap</span><span class="p">))</span><span class="o">-</span><span class="n">unity</span>
      <span class="n">TMP</span><span class="o">=</span><span class="n">J</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Gammap</span><span class="p">)</span>
      <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">sqGammap</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">unity</span><span class="o">-</span><span class="n">TMP</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
      <span class="n">d</span><span class="o">=-</span><span class="mi">2</span><span class="o">*</span><span class="n">sqGamma</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Gammap</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
      <span class="n">E</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">sqGamma</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqGammap</span><span class="p">)</span>
      <span class="n">C</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">sqGamma</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqGamma</span><span class="p">)</span><span class="o">-</span><span class="n">unity</span> 		<span class="c">#this is &#39;real&#39; C-matrix</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>initialize new OPA-object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>      <span class="n">alpha</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
      <span class="n">L3</span><span class="o">=</span><span class="n">OPA</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>    	  	<span class="c"># initialize root-node</span>
      <span class="n">States</span><span class="o">=</span><span class="n">states</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> 		<span class="c"># States are all possible</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">States</span><span class="p">:</span>			<span class="c">#for each possible state, described by n(vector)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>index of excited elements</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">n</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span>	<span class="c">#if there is no excitation: it returns 0</span>
	 <span class="n">I_nn</span><span class="o">=</span><span class="mi">0</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>need first iteration formula</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
	    <span class="n">n_m</span><span class="o">=</span><span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
	    <span class="n">ntemp</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	    <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span> <span class="c">#n[m] is at least 1</span>
	    <span class="n">Ps</span><span class="o">=</span><span class="n">L2</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">:</span>
	       <span class="n">I_nn</span><span class="o">=</span><span class="n">b</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>					<span class="c"># first term </span>
	    <span class="k">if</span> <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	       <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
	       <span class="n">Ps</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	       <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">):</span>
		  <span class="n">I_nn</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">n_m</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>		<span class="c"># second term</span>
	    <span class="k">if</span> <span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	       <span class="n">ntemp</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	       <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
	       <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
     	       <span class="n">Ps</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	       <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">:</span>
		  <span class="n">I_nn</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>	<span class="c"># second term</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>else: need the other iteration-formula</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>	 <span class="k">else</span><span class="p">:</span> 
	    <span class="n">m</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:])</span>				<span class="c"># index of excited elements</span>
	    <span class="n">n_m</span><span class="o">=</span><span class="n">n</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
	    <span class="n">ntemp</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	    <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
	    <span class="n">Ps</span><span class="o">=</span><span class="n">L2</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">:</span>
	       <span class="n">I_nn</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>					<span class="c"># first term </span>
	    <span class="k">if</span> <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
	       <span class="n">ntemp</span><span class="p">[</span><span class="n">m</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
	       <span class="n">Ps</span><span class="o">=</span><span class="n">L1</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">ntemp</span><span class="p">)</span>
	       <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ps</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-8</span><span class="p">:</span>
		  <span class="n">I_nn</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">n_m</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">Ps</span>        	<span class="c"># second term; all other terms vanish in OPA...</span>
     	 <span class="n">I_nn</span><span class="o">/=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n_m</span><span class="p">)</span>
	 <span class="n">L3</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I_nn</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">L2</span><span class="p">,</span> <span class="n">L3</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="k">def</span> <span class="nf">makeLine</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span><span class="n">E0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">Gammap</span><span class="p">,</span><span class="n">E</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
      <span class="n">F</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="mi">3</span> <span class="p">))</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)):</span> 
	 <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	 <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">Gammap</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span>
   		   <span class="n">Gamma</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">ex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">+</span><span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="n">Hartree2cm_1</span>
	 <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">intens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="n">Gamma</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">ex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">E0</span><span class="p">)</span><span class="o">/</span><span class="n">T</span><span class="p">)</span>
	 <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">u&quot;{1}   {0}    {2}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
   
   <span class="n">resort</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">J</span><span class="p">)):</span>
      <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">k</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;-</span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]:</span>
	 <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
	 <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>

   <span class="n">J</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
   <span class="n">K</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resort</span><span class="p">)):</span>
      <span class="n">k</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
	 <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span> <span class="c">#use absolute value only.</span>
   <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

   <span class="n">Gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">Gammap</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c"># for final state</span>

   <span class="n">linspect</span><span class="o">=</span><span class="p">[]</span>
   <span class="n">logging</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;frequency,           intensity ,      mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
   <span class="n">L2</span><span class="o">=</span><span class="n">CalcI00</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">K</span><span class="p">),</span> <span class="n">Energy</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>this is already extracted to linspect (using side-effects)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   <span class="n">L1</span><span class="o">=</span><span class="n">L2</span> 
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="o">=</span><span class="n">iterate</span><span class="p">(</span><span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
      <span class="n">intens</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">excitation</span><span class="o">=</span><span class="n">L2</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
      <span class="n">linspect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">makeLine</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">intens</span><span class="p">,</span><span class="n">E0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">excitation</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">Gammap</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
   <span class="n">dimen</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">)):</span>
      <span class="n">dimen</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
   <span class="n">spect</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dimen</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
   <span class="n">spect</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">dimen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">)):</span>
      <span class="n">spect</span><span class="p">[</span><span class="n">dimen</span><span class="p">:</span><span class="n">dimen</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="o">=</span><span class="n">linspect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">dimen</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">linspect</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
   <span class="k">return</span> <span class="n">spect</span><span class="o">.</span><span class="n">T</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>Calculates the FC-factors for given Duschinsky-effect. No restriction to OPA</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">distFCfOPA</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span><span class="n">E0</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p><em>PARAMETERS:</em>
J:      Duschisky-matrix
K:      Displacement-Vector
f:      frequency: two-dim array (freq_initial, freq_final)
Energy: Energy-difference of minima
N:      Max. number of excitation quanta state considered
T:      temperature of the system (in atomic units)
E0:     relative energy with respect to lowest triplet state</p>
<p>All arguments are obligatory.</p>
<p><em>RETURNS:</em>
linespectrum </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>   
   <span class="n">resort</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">J</span><span class="p">)):</span>
      <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">k</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">&gt;-</span><span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]:</span>
	 <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
	 <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>

   <span class="n">J</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
   <span class="n">K</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resort</span><span class="p">)):</span>
      <span class="n">k</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
	 <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span> <span class="c">#use absolute value only.</span>
   <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
   <span class="n">spect2</span><span class="o">=</span><span class="p">[]</span>
   <span class="n">spect2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simpleFCfOPA</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span><span class="n">E0</span><span class="p">))</span>

   <span class="n">resort</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resort</span><span class="p">))</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">threshold</span><span class="p">):</span>
      <span class="n">vec</span><span class="o">=</span><span class="n">resort</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resort</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
	 <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">resort</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">vec</span>

      <span class="n">J</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
      <span class="n">K</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
      <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
      <span class="n">spect2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simpleFCfOPA</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span><span class="n">E0</span><span class="p">))</span>

   <span class="n">resort</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resort</span><span class="p">))</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">threshold</span><span class="p">):</span>
      <span class="n">vec</span><span class="o">=</span><span class="n">resort</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">resort</span><span class="p">)):</span>
	 <span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">resort</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">resort</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">vec</span>

      <span class="n">J</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
      <span class="n">K</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
      <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">resort</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
      <span class="n">spect2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simpleFCfOPA</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">Energy</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span><span class="n">E0</span><span class="p">))</span>
   <span class="n">dim</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spect2</span><span class="p">)):</span>
      <span class="n">dim</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">spect2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
   <span class="n">spect</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
   <span class="n">leng</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spect2</span><span class="p">)):</span>
      <span class="n">spect</span><span class="p">[</span><span class="n">leng</span><span class="p">:</span><span class="n">leng</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">spect2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span><span class="o">=</span><span class="n">spect2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
      <span class="n">leng</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">spect2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

   <span class="k">return</span> <span class="n">spect</span><span class="o">.</span><span class="n">T</span>

<span class="n">version</span><span class="o">=</span><span class="mf">0.2</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
